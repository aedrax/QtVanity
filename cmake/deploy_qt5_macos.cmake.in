# Qt 5 macOS Deployment Helper Script
# This script is generated by CMake for Qt 5 builds on macOS
# Run this script after building to deploy Qt dependencies

# Configuration variables (set by CMake)
set(QT_DIR "@QT_DIR@")
set(TARGET_BUNDLE "@CMAKE_CURRENT_BINARY_DIR@/QtVanity.app")
set(DEPLOY_DIR "@CMAKE_CURRENT_BINARY_DIR@/deploy")

message(STATUS "Qt 5 macOS Deployment Script")
message(STATUS "  Qt Directory: ${QT_DIR}")
message(STATUS "  Target Bundle: ${TARGET_BUNDLE}")
message(STATUS "  Deploy Directory: ${DEPLOY_DIR}")

# Find macdeployqt
find_program(MACDEPLOYQT_EXECUTABLE macdeployqt
    HINTS "${QT_DIR}/bin"
    DOC "Path to macdeployqt executable"
)

if(NOT MACDEPLOYQT_EXECUTABLE)
    message(FATAL_ERROR "macdeployqt not found. Please make sure Qt bin directory is in PATH.")
endif()

# Create deployment directory
file(MAKE_DIRECTORY ${DEPLOY_DIR})

# Copy bundle to deploy directory
file(COPY ${TARGET_BUNDLE} DESTINATION ${DEPLOY_DIR})

# Run macdeployqt
execute_process(
    COMMAND ${MACDEPLOYQT_EXECUTABLE}
        ${DEPLOY_DIR}/QtVanity.app
        -verbose=1
    RESULT_VARIABLE DEPLOY_RESULT
)

if(NOT DEPLOY_RESULT EQUAL 0)
    message(FATAL_ERROR "macdeployqt failed with error code: ${DEPLOY_RESULT}")
endif()

message(STATUS "Deployment complete. Bundle is in: ${DEPLOY_DIR}/QtVanity.app")
