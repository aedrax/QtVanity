# Qt 5 Windows Deployment Helper Script
# This script is generated by CMake for Qt 5 builds on Windows
# Run this script after building to deploy Qt dependencies

# Configuration variables (set by CMake)
set(QT_DIR "@QT_DIR@")
set(TARGET_EXECUTABLE "@CMAKE_CURRENT_BINARY_DIR@/QtVanity.exe")
set(DEPLOY_DIR "@CMAKE_CURRENT_BINARY_DIR@/deploy")

message(STATUS "Qt 5 Windows Deployment Script")
message(STATUS "  Qt Directory: ${QT_DIR}")
message(STATUS "  Target: ${TARGET_EXECUTABLE}")
message(STATUS "  Deploy Directory: ${DEPLOY_DIR}")

# Find windeployqt
find_program(WINDEPLOYQT_EXECUTABLE windeployqt
    HINTS "${QT_DIR}/bin"
    DOC "Path to windeployqt executable"
)

if(NOT WINDEPLOYQT_EXECUTABLE)
    message(FATAL_ERROR "windeployqt not found. Please make sure Qt bin directory is in PATH.")
endif()

# Create deployment directory
file(MAKE_DIRECTORY ${DEPLOY_DIR})

# Copy executable to deploy directory
file(COPY ${TARGET_EXECUTABLE} DESTINATION ${DEPLOY_DIR})

# Run windeployqt
execute_process(
    COMMAND ${WINDEPLOYQT_EXECUTABLE}
        --dir ${DEPLOY_DIR}
        --no-translations
        --no-system-d3d-compiler
        --no-opengl-sw
        ${DEPLOY_DIR}/QtVanity.exe
    RESULT_VARIABLE DEPLOY_RESULT
)

if(NOT DEPLOY_RESULT EQUAL 0)
    message(FATAL_ERROR "windeployqt failed with error code: ${DEPLOY_RESULT}")
endif()

message(STATUS "Deployment complete. Files are in: ${DEPLOY_DIR}")
